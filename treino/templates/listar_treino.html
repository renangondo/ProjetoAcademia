{% extends 'paginas/modelo.html' %}
{% load static %}

{% block titulo %}Treinos de {{ aluno.nome }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/listar_treino.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
{% endblock %}

{% block conteudo %}
<div class="container-treinos">
    <!-- Header Bonito -->
    <div class="header-treinos">
        <h1><i class="fas fa-user-graduate"></i> {{ aluno.nome }}</h1>
        <p>{{ treinos.count }} treino{{ treinos.count|pluralize }} encontrado{{ treinos.count|pluralize }}</p>
        
        <div class="botoes-header">
            <a href="{% url 'criar_treino_completo' aluno.id %}" class="btn btn-primary">
                <i class="fas fa-plus-circle"></i> Novo Treino
            </a>
            <a href="javascript:history.back()" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
        </div>
    </div>

    <!-- Grid de Cards -->
    {% if treinos %}
        <div class="grid-treinos">
            {% for treino in treinos %}
            <div class="card-treino" style="animation-delay: {% widthratio forloop.counter0 1 0.1 %}s">
                <!-- Header do Card -->
                <div class="card-header">
                    <div class="treino-titulo">
                        <h3 class="nome-treino">{{ treino.nome_treino }}</h3>
                        <span class="status-treino {% if not treino.data_fim %}status-ativo{% else %}status-inativo{% endif %}">
                            <i class="fas fa-circle"></i>
                            {% if not treino.data_fim %}Ativo{% else %}Finalizado{% endif %}
                        </span>
                    </div>
                    
                    <p class="periodo-treino">
                        <i class="fas fa-calendar-alt"></i>
                        {{ treino.data_inicio|date:"d/m/Y" }}
                        {% if treino.data_fim %} - {{ treino.data_fim|date:"d/m/Y" }}{% else %} - Em andamento{% endif %}
                    </p>
                </div>

                <!-- Corpo do Card -->
                <div class="card-body">
                    <!-- Estatísticas -->
                    <div class="stats-treino">
                        <div class="stat-item">
                            <span class="stat-numero">{{ treino.exerciciotreino_set.count }}</span>
                            <div class="stat-label">Exercícios</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-numero">{{ treino.cadastrado_em|timesince|truncatewords:1 }}</span>
                            <div class="stat-label">Criado há</div>
                        </div>
                    </div>

                    <!-- Professor -->
                    <div class="professor-info">
                        <div class="professor-nome">
                            <i class="fas fa-user-tie"></i>
                            Prof. {{ treino.cadastrado_por.first_name|default:treino.cadastrado_por.username }}
                        </div>
                        <div class="data-criacao">
                            <i class="fas fa-clock"></i>
                            Criado em {{ treino.cadastrado_em|date:"d/m/Y H:i" }}
                        </div>
                    </div>

                    <!-- Descrição -->
                    {% if treino.descricao %}
                    <div class="descricao-treino">
                        <p class="descricao-texto">{{ treino.descricao|truncatechars:120 }}</p>
                    </div>
                    {% endif %}

                    <!-- Lista de Exercícios (inicialmente oculta) -->
                    <div class="exercicios-lista" id="exercicios-{{ treino.id }}">
                        <h4 class="exercicios-titulo">
                            <i class="fas fa-dumbbell"></i> Lista de Exercícios
                        </h4>
                        
                        {% if treino.exerciciotreino_set.all %}
                            {% for ex in treino.exerciciotreino_set.all %}
                            <div class="exercicio-item">
                                <div class="exercicio-nome">
                                    {{ ex.exercicio.nome }}
                                </div>
                                <div class="exercicio-detalhes">
                                    <span><i class="fas fa-repeat"></i> {{ ex.series }} séries</span>
                                    <span><i class="fas fa-hashtag"></i> {{ ex.repeticoes }} repetições</span>
                                    {% if ex.descanso %}<span><i class="fas fa-clock"></i> {{ ex.descanso }}s descanso</span>{% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p style="text-align: center; color: #6c757d; font-style: italic;">
                                Nenhum exercício cadastrado ainda.
                            </p>
                        {% endif %}
                    </div>

                    <!-- Botões de Ação -->
                    <div class="acoes-card">
                        <button onclick="toggleExercicios('{{ treino.id }}')" class="btn-acao btn-toggle">
                            <i class="fas fa-eye"></i> <span id="toggle-text-{{ treino.id }}">Ver Exercícios</span>
                        </button>
                        
                        <a href="{% url 'detalhes_treino' treino.pk %}" class="btn-acao btn-detalhes">
                            <i class="fas fa-info-circle"></i> Detalhes
                        </a>
                        
                        <a href="{% url 'editar_treino' treino.pk %}" class="btn-acao btn-editar">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        
                        <a href="{% url 'exportar_treino_pdf' treino.id %}" class="btn-acao btn-pdf">
                            <i class="fas fa-file-pdf"></i> PDF
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- Estado Vazio -->
        <div class="estado-vazio">
            <div class="icone-vazio">
                <i class="fas fa-dumbbell"></i>
            </div>
            <h3>Nenhum treino encontrado</h3>
            <p>{{ aluno.nome }} ainda não possui treinos cadastrados.<br>Vamos criar o primeiro treino personalizado?</p>
            <a href="{% url 'criar_treino_completo' aluno.id %}" class="btn btn-primary">
                <i class="fas fa-plus-circle"></i> Criar Primeiro Treino
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/listar_treino.js' %}"></script>
{% endblock %}
